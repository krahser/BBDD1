# Consulta 5
select p.dniPaciente, count(i.codHospital) hospitales_paciente,(select count(*) from hospital h where h.ciudadHospital = ciudadPaciente) as cantidad
from paciente p
inner join internacion i on p.dniPaciente = i.dniPaciente
inner join hospital h on p.ciudadPaciente = h.ciudadHospital
group by p.dniPaciente
having hospitales_paciente = cantidad


# Consulta 6
  #Normalizada
  select p.dniPaciente
  from paciente p
  inner join internacion i on p.dniPaciente = i.dniPaciente
  where p.ciudadPaciente = i.ciudadInternacionPaciente and p.domicilioPaciente = i.direccionInternacionPaciente
  group by p.dniPaciente
 
  #Desnormalizada
  select dniPaciente
  from internacion
  where ciudadPaciente = ciudadInternacionPaciente and domicilioPaciente = direccionInternacionPaciente
  group by dniPaciente

# Consulta 7
  #Normalizada
  select codHospital, i.dniPaciente, i.fechaInicioInternacion, count(insumoInternacion) as cantidad_insumos
  from internacion i
  inner join insumointernacion ii on i.dniPaciente = ii.dniPaciente
  where i.fechaInicioInternacion = ii.fechaInicioInternacion
  having cantidad_insumos > 3
  
  
  
  #Punto 15
  #Plan 1
    La consulta cuenta la cantidad de pacientes que atendio el 'Dr. Sosa', en los hospitales con menos de 35 habitaciones en 'Vicente Lopez'

     #Sin indice
     *La consulta sin indices trae toda las filas de la tabla paciente ~200000, y las escanea a todas para encontrar las que coinciden.
     *Utiliza la clave primaria para buscar ya que no posee indice.

     #Con indice
     *La consulta con indice trae solo ~15000 filas de la tabla atencioninternacion, ya que gracias a los indices idx_canthab y idx_ciu_hosp, se pudo obtener
      mejor las tuplas flitradas por idx_canthab > 35 y idx_ciu_hosp = 'Vicente Lopez' de la tabla hospitales.
     *Las consulta tambien aprovecha el indice idx_dr donde se lo filtra con un valor constante al igual que los demas indices, en este caso 'Dr. Sosa'
  #Plan 2
    La consulta muestra todas las internaciones que atendio el 'Dr. Dominguez' en en los hospitales con mas de 42 habitaciones en 'Vicente Lopez' entre las fechas 
    '2006-01-01' y '2006-12-31'.

     #Sin indice
     *Se ejecuta sin orden, analizando toda la tabla de pacientes, luego la tabla de internaciones es filtrada por el dniPaciente, seguido de la tabla de hospitales
      filtrada por codHospital y por ultimo la tabla de atencioninternacion en la cual se comparan las columnas dniPaciente, fechaInicioInternacion, 

     #Con indice
     *Se ejecuta ordenada de forma que se filtran primero los hospitales de 'Vicente Lopez' y luego las atenciones del 'Dr. Dominguez', luego los pacientes 
     que tienen internaciones atendidas por el doctor entre las fechas establecidas. En total se comparan muchas menos filas en comparacion a la ejecucion de la consulta
     sin indice
  #Plan 3
    La consulta muestra lo mismo que la consulta del plan 2, solamente que en vez de usar la tabla de hospitales completa, utiliza una tabla ya filtrada por 
    ciudadhospital='Vicente Lopez' y cantidadhabitaciones >42.

     #Sin indice
     *Al utilizar una tabla resultante de una sub consulta se ve reflejado una mejora en la performance ya que en la misma, se filtra por campos constantes
     ciudadhospital='Vicente Lopez' y cantidadhabitaciones >42, esto hace que la cantidad de tuplas filtradas sea menor.

     #Con indice
     *Sin embargo la consulta que utiliza indices sigue teniendo mejor performance ya que la cantidad de tuplas en las que tiene que buscar las coincidencias
      es casi la mitad de las que tuvo que utilizar la consulta sin indices
